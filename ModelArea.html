<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta content="width=device-width, initial-scale=1.0" name="viewport" />
    <title>Functional Dashboard</title>
    <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet" />
    <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;500;700&display=swap" rel="stylesheet" />
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet" />
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- jsPDF Library for PDF Generation -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <!-- Signature Pad Library -->
    <script src="https://cdn.jsdelivr.net/npm/signature_pad@4.0.0/dist/signature_pad.umd.min.js"></script>

    <style type="text/tailwindcss">
        body {
            font-family: 'Roboto', sans-serif;
            background-color: #f7f8fa;
        }
        .icon {
            font-family: 'Material Icons';
        }
        #date-range-card {
            transition: opacity 0.2s ease-in-out, transform 0.2s ease-in-out;
            transform-origin: top right;
        }
        input[type="date"]::-webkit-calendar-picker-indicator {
            background: transparent;
            bottom: 0;
            color: transparent;
            cursor: pointer;
            height: auto;
            left: 0;
            position: absolute;
            right: 0;
            top: 0;
            width: auto;
        }
        aside, main {
            transition: all 0.3s ease-in-out;
        }
        .gradient-text {
            background: linear-gradient(90deg, #FBBF24, #F59E0B);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        :root {
            --primary-color: #FFE500;
            --primary-color-hover: #e6cf00;
        }
        .form-container {
            transition: all 0.5s ease-in-out;
            max-height: 0;
            overflow: hidden;
            opacity: 0;
        }
        .form-container.show {
            max-height: 2500px;
            opacity: 1;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.6);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease, visibility 0.3s ease;
        }
        .modal-overlay.show {
            opacity: 1;
            visibility: visible;
        }
        .modal-content {
            background-color: white;
            padding: 2rem;
            border-radius: 1rem;
            width: 90%;
            max-width: 800px;
            max-height: 90vh;
            overflow-y: auto;
            transform: scale(0.95);
            transition: transform 0.3s ease;
        }
        .model-card {
            width: 60%;
        }
        .modal-overlay.show .modal-content {
            transform: scale(1);
        }
        #contract-modal .modal-content, #signature-modal .modal-content {
             max-width: 500px;
        }
        .main-btn { background-color: var(--primary-color); color: #1a202c; font-weight: bold; padding: 0.75rem 1.5rem; border-radius: 1rem; box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1), 0 2px 4px -2px rgba(0,0,0,0.1); transition: all 0.2s ease-in-out; }
        .main-btn:hover { background-color: var(--primary-color-hover); box-shadow: 0 10px 15px -3px rgba(0,0,0,0.1), 0 4px 6px -2px rgba(0,0,0,0.1); }
        .main-btn:disabled { background-color: #e2e8f0; color: #a0aec0; cursor: not-allowed; box-shadow: none; }

        /* --- Flip Card Styles --- */
        .flip-card {
            background-color: transparent;
            width: 100%;
            height: 320px;
            perspective: 1000px;
            cursor: pointer;
        }
        .flip-card-inner {
            position: relative;
            width: 100%;
            height: 100%;
            text-align: center;
            transition: transform 0.8s;
            transform-style: preserve-3d;
            box-shadow: 0 4px 8px 0 rgba(0,0,0,0.2);
            border-radius: 0.75rem;
        }
        .flip-card:hover .flip-card-inner {
            transform: rotateY(180deg);
        }
        .flip-card-front, .flip-card-back {
            position: absolute;
            width: 100%;
            height: 100%;
            -webkit-backface-visibility: hidden;
            backface-visibility: hidden;
            border-radius: 0.75rem;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }
        .flip-card-front {
            background-color: white;
        }
        .flip-card-back {
            background-color: white;
            color: #333;
            transform: rotateY(180deg);
            padding: 1.5rem;
            justify-content: center;
            align-items: flex-start;
            text-align: left;
        }
        .flip-card-back h4 {
            font-size: 1.25rem;
            font-weight: bold;
            margin-bottom: 1rem;
            border-bottom: 2px solid var(--primary-color);
            padding-bottom: 0.5rem;
            width: 100%;
        }
        .flip-card-back p {
            font-size: 0.9rem;
            margin-bottom: 0.5rem;
        }
        .action-btn {
            padding: 0.5rem;
            border-radius: 0.375rem; /* 6px */
            color: white;
            transition: background-color 0.2s ease-in-out;
        }
        /* --- Notification Styles --- */
        .notification {
            position: fixed;
            bottom: 20px;
            right: 20px;
            padding: 1rem 1.5rem;
            border-radius: 0.5rem;
            color: white;
            font-weight: 500;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            z-index: 2000;
            opacity: 0;
            transform: translateY(20px);
            transition: opacity 0.3s ease, transform 0.3s ease;
        }
        .notification.show {
            opacity: 1;
            transform: translateY(0);
        }
        .notification.success {
            background-color: #48bb78; /* green-500 */
        }
        .notification.error {
            background-color: #f56565; /* red-500 */
        }
        /* --- Loader --- */
        .loader {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #FBBF24;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        /* Signature Pad */
        .signature-pad {
            border: 2px dashed #ccc;
            border-radius: 0.5rem;
            cursor: crosshair;
        }
    </style>
</head>

<body class="bg-gray-100">
    <div class="flex h-screen">
        <!-- Sidebar -->
        <aside id="sidebar" class="w-20 hover:w-56 bg-white shadow-lg flex flex-col py-4 fixed h-full group z-20">
            <!-- Logo -->
            <div class="h-16 flex items-center justify-center mb-4 px-4 text-xl font-bold text-gray-800 whitespace-nowrap">
                <span class="inline group-hover:hidden">VDM</span>
                <span class="hidden group-hover:inline">Viral Dose Media</span>
            </div>
            <!-- Navigation -->
            <nav class="flex flex-col space-y-2 flex-grow px-4 justify-center">
                <a href="#" class="nav-link flex items-center p-3 bg-yellow-400 text-white rounded-lg" data-target="dashboard-page">
                    <span class="material-icons">dashboard</span>
                    <span class="ml-4 text-sm font-bold opacity-0 group-hover:opacity-100 transition-opacity duration-200">DashBoard</span>
                </a>
                <a href="#" class="nav-link flex items-center p-3 text-gray-500 hover:bg-gray-100 rounded-lg" data-target="add-model-page">
                    <span class="material-icons">add_box</span>
                     <span class="ml-4 text-sm font-bold opacity-0 group-hover:opacity-100 transition-opacity duration-200">Add Model</span>
                </a>
                <!-- Contracts Nav Link -->
                <a href="#" class="nav-link flex items-center p-3 text-gray-500 hover:bg-gray-100 rounded-lg" data-target="contracts-page">
                    <span class="material-icons">gavel</span>
                     <span class="ml-4 text-sm font-bold opacity-0 group-hover:opacity-100 transition-opacity duration-200">Contracts</span>
                </a>
            </nav>
            <!-- User Profile & Logout -->
            <div class="px-4">
                 <div class="flex items-center w-full p-3 rounded-lg">
                     <div class="w-10 h-10 bg-yellow-400 rounded-full flex items-center justify-center text-white font-bold shrink-0">A</div>
                     <div class="ml-4 opacity-0 group-hover:opacity-100 transition-opacity duration-200">
                         <p class="text-sm font-bold text-gray-800">Admin</p>
                    </div>
                </div>
                <a id="logout-btn" class="flex items-center w-full p-3 text-gray-500 hover:bg-gray-100 rounded-lg" href="#">
                    <span class="material-icons">logout</span>
                    <span class="ml-4 text-sm font-bold opacity-0 group-hover:opacity-100 transition-opacity duration-200">Logout</span>
                </a>
            </div>
        </aside>

        <!-- Main Content -->
        <main id="main-content" class="flex-1 ml-20 overflow-y-auto bg-gray-100">
            <!-- Dashboard Page -->
            <div id="dashboard-page" class="page-content p-8">
                <header class="flex justify-between items-center mb-8">
                    <div>
                        <h1 class="text-3xl font-bold text-gray-800">Dashboard</h1>
                        <p class="text-gray-500">Overview of key metrics and performance indicators</p>
                    </div>
                    <div class="flex items-center space-x-4">
                        <!-- Date Range Selector Button and Card -->
                        <div class="relative">
                            <button id="date-range-btn" class="flex items-center space-x-2 px-4 py-2 bg-white border border-gray-300 rounded-lg shadow-sm hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-yellow-400">
                                <span class="material-icons text-gray-500">filter_list</span>
                                <span id="date-range-text" class="text-gray-700">Last 7 Days</span>
                            </button>
                            <!-- Dropdown Card -->
                            <div id="date-range-card" class="absolute right-0 mt-2 w-72 bg-white rounded-lg shadow-xl p-4 z-10 hidden opacity-0 transform scale-95">
                                <h3 class="text-sm font-semibold text-gray-800 mb-3">Quick Ranges</h3>
                                <div class="grid grid-cols-2 gap-2 mb-4">
                                    <button class="date-range-option px-3 py-2 text-sm text-center bg-yellow-400 text-white rounded-md hover:bg-yellow-500">Last 7 Days</button>
                                    <button class="date-range-option px-3 py-2 text-sm text-center bg-gray-100 text-gray-700 rounded-md hover:bg-gray-200">Last 30 Days</button>
                                    <button class="date-range-option px-3 py-2 text-sm text-center bg-gray-100 text-gray-700 rounded-md hover:bg-gray-200">Last Year</button>
                                    <button class="date-range-option px-3 py-2 text-sm text-center bg-gray-100 text-gray-700 rounded-md hover:bg-gray-200">All Time</button>
                                </div>
                                <h3 class="text-sm font-semibold text-gray-800 mb-3">Custom Range</h3>
                                <div class="space-y-3">
                                    <div class="relative flex items-center">
                                        <label for="from-date" class="text-sm text-gray-600 w-12">From:</label>
                                        <input type="date" id="from-date" class="w-full text-sm border-gray-300 rounded-md shadow-sm p-2 focus:ring-yellow-400 focus:border-yellow-400">
                                    </div>
                                    <div class="relative flex items-center">
                                        <label for="to-date" class="text-sm text-gray-600 w-12">To:</label>
                                        <input type="date" id="to-date" class="w-full text-sm border-gray-300 rounded-md shadow-sm p-2 focus:ring-yellow-400 focus:border-yellow-400">
                                    </div>
                                </div>
                                <button id="apply-date-range" class="mt-4 w-full bg-yellow-400 text-white font-semibold py-2 rounded-lg hover:bg-yellow-500">Apply</button>
                            </div>
                        </div>
                    </div>
                </header>

                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                     <div class="bg-white p-6 rounded-xl shadow-sm flex items-center justify-between h-40">
                         <div>
                             <p class="text-gray-500 text-sm">Revenue</p>
                             <p class="text-3xl font-bold text-gray-800">$93,000</p>
                        </div>
                         <div class="bg-yellow-100 p-4 rounded-full">
                             <span class="material-icons text-yellow-500">attach_money</span>
                        </div>
                    </div>
                    <div class="bg-white p-6 rounded-xl shadow-sm flex items-center justify-between h-40">
                        <div>
                            <p class="text-gray-500 text-sm">Profit</p>
                            <p class="text-3xl font-bold text-gray-800">$12,500</p>
                        </div>
                        <div class="bg-blue-100 p-4 rounded-full">
                            <span class="material-icons text-blue-500">trending_up</span>
                        </div>
                    </div>
                    <div class="bg-white p-6 rounded-xl shadow-sm flex items-center justify-between h-40">
                        <div>
                            <p class="text-gray-500 text-sm">Total Models</p>
                            <p id="total-models-stat" class="text-3xl font-bold text-gray-800">0</p>
                        </div>
                        <div class="bg-green-100 p-4 rounded-full">
                            <span class="material-icons text-green-500">model_training</span>
                        </div>
                    </div>
                    <div class="bg-white p-6 rounded-xl shadow-sm flex items-center justify-between h-40">
                        <div>
                            <p class="text-gray-500 text-sm">Daily Visitors</p>
                            <p class="text-3xl font-bold text-gray-800">1,204</p>
                        </div>
                        <div class="bg-purple-100 p-4 rounded-full">
                            <span class="material-icons text-purple-500">people</span>
                        </div>
                    </div>
                </div>

                <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                    <div class="lg:col-span-2 bg-white p-6 rounded-xl shadow-sm">
                        <div class="flex justify-between items-center mb-4">
                            <h2 id="chart-title" class="text-xl font-bold text-gray-800">Revenue</h2>
                            <div>
                                <select id="chartTypeSelector" class="rounded-md border-gray-300 shadow-sm focus:border-yellow-400 focus:ring focus:ring-yellow-200 focus:ring-opacity-50">
                                    <option value="revenue">Revenue</option>
                                    <option value="profit">Profit</option>
                                </select>
                            </div>
                        </div>
                        <div class="h-80">
                            <canvas id="revenueChart"></canvas>
                        </div>
                    </div>
                    <div class="bg-white p-6 rounded-xl shadow-sm">
                        <h2 class="text-xl font-bold text-gray-800 mb-4">Logs</h2>
                        <div id="logs-container" class="space-y-4">
                           <!-- Logs will be dynamically inserted here -->
                        </div>
                    </div>
                </div>
            </div>
            <!-- Add Model Page -->
            <div id="add-model-page" class="page-content hidden p-8">
                <h2 class="text-3xl font-bold mb-8">Manage Models</h2>

                <!-- Toolbar: Search and Add Button -->
                <div class="flex flex-wrap gap-4 items-center justify-between mb-6">
                    <div class="relative flex-grow max-w-sm">
                        <input type="text" id="search-model-input" placeholder="Search by name..." class="w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-yellow-400 focus:border-transparent transition">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-search absolute left-3 top-1/2 -translate-y-1/2 text-gray-400"><circle cx="11" cy="11" r="8"/><path d="m21 21-4.3-4.3"/></svg>
                    </div>
                    <button id="show-form-btn" class="main-btn flex items-center">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-plus-circle mr-2"><circle cx="12" cy="12" r="10"/><line x1="12" x2="12" y1="8" y2="16"/><line x1="8" x2="16" y1="12" y2="12"/></svg>
                        Add New Model
                    </button>
                </div>

                <!-- Add/Edit Model Form -->
                <div id="add-model-form-container" class="form-container bg-white p-8 rounded-xl shadow-lg mb-8">
                    <form id="add-model-form" class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <h3 id="form-title" class="col-span-1 md:col-span-2 text-2xl font-semibold border-b pb-4 mb-2">New Model Information</h3>
                        <input type="hidden" id="editModelId">

                        <!-- Form fields... -->
                        <div class="col-span-1"><label for="fullName" class="block text-sm font-medium text-gray-700 mb-1">Full Name</label><input type="text" id="fullName" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-yellow-400 focus:border-transparent transition"></div>
                        <div class="col-span-1"><label for="phoneNumber" class="block text-sm font-medium text-gray-700 mb-1">Phone Number</label><input type="tel" id="phoneNumber" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-yellow-400 focus:border-transparent transition"></div>
                        <div class="col-span-1"><label for="email" class="block text-sm font-medium text-gray-700 mb-1">Email Address</label><input type="email" id="email" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-yellow-400 focus:border-transparent transition"></div>
                        <div class="col-span-1"><label for="nationality" class="block text-sm font-medium text-gray-700 mb-1">Nationality</label><input type="text" id="nationality" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-yellow-400 focus:border-transparent transition"></div>
                        <div class="col-span-1"><label for="languages" class="block text-sm font-medium text-gray-700 mb-1">Languages Spoken</label><input type="text" id="languages" placeholder="e.g., English, Arabic" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-yellow-400 focus:border-transparent transition"></div>
                        <div class="col-span-1"><label for="location" class="block text-sm font-medium text-gray-700 mb-1">Location (City/Emirate)</label><input type="text" id="location" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-yellow-400 focus:border-transparent transition"></div>
                        <div class="col-span-1"><label for="height" class="block text-sm font-medium text-gray-700 mb-1">Height (cm)</label><input type="number" id="height" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-yellow-400 focus:border-transparent transition"></div>
                        <div class="col-span-1"><label for="experience" class="block text-sm font-medium text-gray-700 mb-1">Experience Level</label><select id="experience" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-yellow-400 focus:border-transparent transition"><option>Beginner</option><option>Intermediate</option><option>Pro</option></select></div>
                        <div class="col-span-1 md:col-span-2"><label for="clients" class="block text-sm font-medium text-gray-700 mb-1">Previous Clients / Campaigns</label><textarea id="clients" rows="3" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-yellow-400 focus:border-transparent transition"></textarea></div>
                        <div class="col-span-1 md:col-span-2"><label for="portfolio" class="block text-sm font-medium text-gray-700 mb-1">Instagram or Portfolio Link</label><input type="url" id="portfolio" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-yellow-400 focus:border-transparent transition"></div>
                        <div class="col-span-1"><label for="profilePhoto" class="block text-sm font-medium text-gray-700 mb-1">Profile Photo</label><input type="file" id="profilePhoto" accept="image/*" class="w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-lg file:border-0 file:text-sm file:font-semibold file:bg-yellow-100 file:text-yellow-700 hover:file:bg-yellow-200 transition"></div>
                        <div class="col-span-1"><label for="gallery" class="block text-sm font-medium text-gray-700 mb-1">Gallery (Photos)</label><input type="file" id="gallery" multiple accept="image/*" class="w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-lg file:border-0 file:text-sm file:font-semibold file:bg-yellow-100 file:text-yellow-700 hover:file:bg-yellow-200 transition"></div>
                        <div class="col-span-1"><label for="videos" class="block text-sm font-medium text-gray-700 mb-1">Videos</label><input type="file" id="videos" multiple accept="video/*" class="w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-lg file:border-0 file:text-sm file:font-semibold file:bg-yellow-100 file:text-yellow-700 hover:file:bg-yellow-200 transition"></div>
                        <div class="col-span-1 md:col-span-2"><label class="block text-sm font-medium text-gray-700 mb-2">Willing to Wear</label><div class="grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-5 gap-4" id="willingToWearCheckboxes"><label class="flex items-center space-x-2"><input type="checkbox" value="Traditional" class="rounded text-yellow-500 focus:ring-yellow-400"><span>Traditional</span></label><label class="flex items-center space-x-2"><input type="checkbox" value="Casual" class="rounded text-yellow-500 focus:ring-yellow-400"><span>Casual</span></label><label class="flex items-center space-x-2"><input type="checkbox" value="Glamour" class="rounded text-yellow-500 focus:ring-yellow-400"><span>Glamour</span></label><label class="flex items-center space-x-2"><input type="checkbox" value="Swimwear" class="rounded text-yellow-500 focus:ring-yellow-400"><span>Swimwear</span></label><label class="flex items-center space-x-2"><input type="checkbox" value="Lingerie" class="rounded text-yellow-500 focus:ring-yellow-400"><span>Lingerie</span></label></div></div>
                        <h3 class="col-span-1 md:col-span-2 text-xl font-semibold border-b pb-3 mb-1 mt-4">Internal & Financial</h3>
                        <div class="col-span-1"><label for="rate" class="block text-sm font-medium text-gray-700 mb-1">Rate per Project/Day ($)</label><input type="number" id="rate" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-yellow-400 focus:border-transparent transition"></div>
                        <div class="col-span-1"><label for="commission" class="block text-sm font-medium text-gray-700 mb-1">Commission Split (%)</label><input type="number" id="commission" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-yellow-400 focus:border-transparent transition"></div>
                        <div class="col-span-1 md:col-span-2"><label for="iban" class="block text-sm font-medium text-gray-700 mb-1">IBAN Number</label><input type="text" id="iban" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-yellow-400 focus:border-transparent transition"></div>
                        <div class="col-span-1 md:col-span-2"><label for="notes" class="block text-sm font-medium text-gray-700 mb-1">Notes / Comments (Internal)</label><textarea id="notes" rows="3" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-yellow-400 focus:border-transparent transition"></textarea></div>
                        <div class="col-span-1 md:col-span-2 flex justify-end space-x-4 mt-4">
                            <button type="button" id="cancel-form-btn" class="bg-gray-200 text-gray-700 hover:bg-gray-300 font-bold py-2 px-6 rounded-lg transition">Cancel</button>
                            <button type="submit" id="save-model-btn" class="main-btn">Save Model</button>
                        </div>
                    </form>
                </div>

                <!-- Model Cards Container -->
                <div id="model-cards-container" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6">
                    <!-- Models will be dynamically inserted here -->
                </div>
            </div>
            <!-- Contracts Page -->
            <div id="contracts-page" class="page-content hidden p-8">
                <header class="flex justify-between items-center mb-8">
                    <div>
                        <h1 class="text-3xl font-bold text-gray-800">Contracts</h1>
                        <p class="text-gray-500">Generate and manage model contracts</p>
                    </div>
                    <button id="create-contract-btn" class="main-btn flex items-center">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-file-plus-2 mr-2"><path d="M4 22h14a2 2 0 0 0 2-2V7.5L14.5 2H6a2 2 0 0 0-2 2v4"/><polyline points="14 2 14 8 20 8"/><path d="M3 15h6"/><path d="M6 12v6"/></svg>
                        Create New Contract
                    </button>
                </header>
                <div class="bg-white p-8 rounded-xl shadow-lg">
                    <h2 class="text-xl font-bold text-gray-800 mb-4">Contract History</h2>
                    <div id="contract-history-container">
                        <!-- Contract history will be dynamically inserted here -->
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Model Details Modal -->
    <div id="model-details-modal" class="modal-overlay">
        <div id="modal-content-box" class="modal-content">
            <!-- Content will be injected by JavaScript -->
        </div>
    </div>

    <!-- Contract Creation Modal -->
    <div id="contract-modal" class="modal-overlay">
        <div class="modal-content">
            <div class="flex justify-between items-start mb-6">
                <h2 class="text-2xl font-bold text-gray-800">New Contract</h2>
                <button id="contract-modal-close-btn" class="text-gray-500 hover:text-gray-800 text-4xl">&times;</button>
            </div>
            <form id="contract-form" class="space-y-6">
                <div>
                    <label for="modelName" class="block text-sm font-medium text-gray-700 mb-1">Model Name</label>
                    <input type="text" id="modelName" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-yellow-400 focus:border-transparent transition">
                </div>
                 <div>
                    <label for="agencyRepresentative" class="block text-sm font-medium text-gray-700 mb-1">Agency Representative</label>
                    <input type="text" id="agencyRepresentative" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-yellow-400 focus:border-transparent transition">
                </div>
                <div>
                    <label for="contractDate" class="block text-sm font-medium text-gray-700 mb-1">Date</label>
                    <input type="date" id="contractDate" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-yellow-400 focus:border-transparent transition">
                </div>
                <div class="flex justify-end items-center space-x-4 pt-4">
                    <button type="button" id="cancel-contract-btn" class="bg-gray-200 text-gray-700 hover:bg-gray-300 font-bold py-2 px-6 rounded-lg transition">Cancel</button>
                    <button type="submit" id="generate-pdf-btn" class="main-btn flex items-center justify-center w-48">
                        <span class="btn-text">Proceed to Sign</span>
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Admin Signature Modal -->
    <div id="signature-modal" class="modal-overlay">
        <div class="modal-content">
            <h2 class="text-2xl font-bold text-gray-800 mb-4">Admin Signature</h2>
            <p class="text-gray-600 mb-4">Please provide your signature to proceed.</p>
            <div class="bg-white p-4 border rounded-lg">
                <canvas id="admin-signature-pad" class="signature-pad w-full h-48"></canvas>
            </div>
            <div class="flex justify-between items-center mt-4">
                <div>
                    <label for="upload-signature" class="text-sm font-medium text-blue-600 hover:text-blue-800 cursor-pointer">
                        Or Upload Signature
                    </label>
                    <input type="file" id="upload-signature" class="hidden" accept="image/png, image/jpeg">
                </div>
                <div class="flex space-x-4">
                    <button id="clear-admin-signature" class="bg-gray-200 text-gray-700 hover:bg-gray-300 font-bold py-2 px-6 rounded-lg transition">Clear</button>
                    <button id="save-admin-signature" class="main-btn">Save & Generate Link</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Model Link Modal -->
    <div id="model-link-modal" class="modal-overlay">
        <div class="modal-content max-w-lg">
             <h2 class="text-2xl font-bold text-gray-800 mb-4">Model Signing Link</h2>
             <p class="text-gray-600 mb-4">Share this secure link with your model for them to review and sign the contract.</p>
             <div class="relative bg-gray-100 p-3 rounded-lg">
                <input type="text" id="model-link-input" readonly class="w-full bg-transparent border-0 text-gray-700 focus:ring-0">
                <button id="copy-link-btn" class="absolute right-2 top-1/2 -translate-y-1/2 bg-yellow-400 text-white px-3 py-1 rounded-md hover:bg-yellow-500">Copy</button>
             </div>
             <div class="text-right mt-6">
                <button id="close-link-modal" class="main-btn">Done</button>
             </div>
        </div>
    </div>


    <!-- Notification Container -->
    <div id="notification-container"></div>

    <script type="module">
        // Import Firebase modules
        import { initializeApp } from "https://www.gstatic.com/firebasejs/12.1.0/firebase-app.js";
        import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/12.1.0/firebase-auth.js";
        import { getFirestore, doc, getDoc, addDoc, setDoc, updateDoc, deleteDoc, onSnapshot, collection, query, where, getDocs, serverTimestamp } from "https://www.gstatic.com/firebasejs/12.1.0/firebase-firestore.js";

        // --- PDF Generation Library ---
        const { jsPDF } = window.jspdf;

        // --- Global State ---
        let models = [];
        let contracts = [];
        let currentContract = null;
        let adminSignaturePad;
        let db, auth;
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';

        // --- Initialize App ---
        document.addEventListener('DOMContentLoaded', async () => {
            // --- Firebase Initialization ---
            const firebaseConfig = {
                apiKey: "AIzaSyBl-_h0gZvIwKqudXq-Tj4X3O9PzVYml3A",
                authDomain: "viraldosemodels.firebaseapp.com",
                projectId: "viraldosemodels",
                storageBucket: "viraldosemodels.firebasestorage.app",
                messagingSenderId: "1067901876974",
                appId: "1:1067901876974:web:28e63a8fda4224967c91ff"
            };
            const app = initializeApp(firebaseConfig);
            db = getFirestore(app);
            auth = getAuth(app);

            onAuthStateChanged(auth, async (user) => {
                if (user) {
                    // User is signed in. Start loading data.
                    loadModelsFromFirestore();
                    listenForContracts();
                    listenForLogs();
                    initializeChart();
                } else {
                    // User is signed out. Redirect to login page.
                    window.location.href = 'login.html';
                }
            });

            // --- Logout Logic ---
            const logoutBtn = document.getElementById('logout-btn');
            if(logoutBtn) {
                logoutBtn.addEventListener('click', async (e) => {
                    e.preventDefault();
                    await signOut(auth);
                    sessionStorage.removeItem('user');
                    window.location.href = 'login.html';
                });
            }

            // --- Sidebar Logic ---
            const sidebar = document.getElementById('sidebar');
            const mainContent = document.getElementById('main-content');

            sidebar.addEventListener('mouseenter', () => {
                mainContent.style.marginLeft = '14rem';
            });

            sidebar.addEventListener('mouseleave', () => {
                mainContent.style.marginLeft = '5rem';
            });

            // --- Tab Switching Logic ---
            const navLinks = document.querySelectorAll('.nav-link');
            const pages = document.querySelectorAll('.page-content');

            function showPage(targetId) {
                 pages.forEach(page => {
                    page.classList.add('hidden');
                });
                const targetPage = document.getElementById(targetId);
                if (targetPage) {
                    targetPage.classList.remove('hidden');
                }
            }

            navLinks.forEach(link => {
                link.addEventListener('click', (event) => {
                    event.preventDefault();
                    const targetId = link.getAttribute('data-target');
                    showPage(targetId);

                    navLinks.forEach(navLink => {
                        navLink.classList.remove('bg-yellow-400', 'text-white');
                        navLink.classList.add('text-gray-500', 'hover:bg-gray-100');
                    });
                    link.classList.add('bg-yellow-400', 'text-white');
                    link.classList.remove('text-gray-500', 'hover:bg-gray-100');
                });
            });

            // --- Firestore Functions ---
            const modelsCollectionRef = () => collection(db, 'models');
            const contractsCollectionRef = () => collection(db, 'contracts');
            const logsCollectionRef = () => collection(db, 'logs');

            async function loadModelsFromFirestore() {
                const querySnapshot = await getDocs(modelsCollectionRef());
                models = querySnapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                renderAllModels();
                updateDashboardStats();
            }

            function listenForContracts() {
                onSnapshot(contractsCollectionRef(), (snapshot) => {
                    contracts = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                    renderContractHistory();
                });
            }

            function listenForLogs() {
                const q = query(logsCollectionRef(), where("timestamp", "!=", null));
                onSnapshot(q, (snapshot) => {
                    const logs = snapshot.docs.map(doc => doc.data());
                    // Sort logs by timestamp descending
                    logs.sort((a, b) => b.timestamp.toMillis() - a.timestamp.toMillis());
                    renderLogs(logs);
                });
            }

            async function addLog(message) {
                try {
                    const userEmail = auth.currentUser ? auth.currentUser.email : 'Anonymous';
                    await addDoc(logsCollectionRef(), {
                        message: message,
                        user: userEmail,
                        timestamp: serverTimestamp()
                    });
                } catch (error) {
                    console.error("Error adding log: ", error);
                }
            }

            // --- Model Management ---
            const showFormBtn = document.getElementById('show-form-btn');
            const cancelFormBtn = document.getElementById('cancel-form-btn');
            const formContainer = document.getElementById('add-model-form-container');
            const addModelForm = document.getElementById('add-model-form');
            const modelCardsContainer = document.getElementById('model-cards-container');
            const searchInput = document.getElementById('search-model-input');
            const modelDetailsModal = document.getElementById('model-details-modal');
            const modalContentBox = document.getElementById('modal-content-box');
            const totalModelsStat = document.getElementById('total-models-stat');

            const updateDashboardStats = () => {
                if (totalModelsStat) {
                    totalModelsStat.textContent = models.length;
                }
            };

            const renderAllModels = () => {
                if (!modelCardsContainer) return;
                modelCardsContainer.innerHTML = '';
                models.forEach(createModelCard);
            };

            const showForm = (show = true) => {
                if (!formContainer) return;
                formContainer.classList.toggle('show', show);
                if (!show) {
                    addModelForm.reset();
                    document.getElementById('editModelId').value = '';
                    document.getElementById('form-title').textContent = 'New Model Information';
                    document.getElementById('save-model-btn').textContent = 'Save Model';
                    document.getElementById('profilePhoto').required = true;
                }
            };

            if(showFormBtn) showFormBtn.addEventListener('click', () => showForm(true));
            if(cancelFormBtn) cancelFormBtn.addEventListener('click', () => showForm(false));

            if(addModelForm) addModelForm.addEventListener('submit', async (e) => {
                e.preventDefault();
                const modelId = document.getElementById('editModelId').value;
                const isEditing = !!modelId;
                const willingToWear = Array.from(document.querySelectorAll('#willingToWearCheckboxes input:checked')).map(cb => cb.value);

                let modelData = {
                    fullName: document.getElementById('fullName').value,
                    phoneNumber: document.getElementById('phoneNumber').value,
                    email: document.getElementById('email').value,
                    nationality: document.getElementById('nationality').value,
                    languages: document.getElementById('languages').value,
                    location: document.getElementById('location').value,
                    height: document.getElementById('height').value,
                    experience: document.getElementById('experience').value,
                    clients: document.getElementById('clients').value,
                    portfolio: document.getElementById('portfolio').value,
                    willingToWear: willingToWear,
                    rate: document.getElementById('rate').value,
                    commission: document.getElementById('commission').value,
                    iban: document.getElementById('iban').value,
                    notes: document.getElementById('notes').value,
                    profilePhotoUrl: ''
                };

                const profilePhotoInput = document.getElementById('profilePhoto');
                if (profilePhotoInput.files.length > 0) {
                    modelData.profilePhotoUrl = await toBase64(profilePhotoInput.files[0]);
                } else if (isEditing) {
                    const existingModel = models.find(m => m.id === modelId);
                    modelData.profilePhotoUrl = existingModel.profilePhotoUrl;
                } else {
                    modelData.profilePhotoUrl = `https://placehold.co/400x400/FBBF24/FFFFFF?text=${modelData.fullName.charAt(0)}`;
                }

                if (isEditing) {
                    const docRef = doc(db, 'models', modelId);
                    await setDoc(docRef, modelData);
                    addLog(`Updated model: ${modelData.fullName}`);
                } else {
                    await addDoc(modelsCollectionRef(), modelData);
                    addLog(`Added new model: ${modelData.fullName}`);
                }

                loadModelsFromFirestore();
                showForm(false);
            });

            const createModelCard = (data) => {
                const cardWrapper = document.createElement('div');
                cardWrapper.className = 'model-card';
                cardWrapper.dataset.modelId = data.id;
                cardWrapper.dataset.modelInfo = JSON.stringify(data);
                cardWrapper.innerHTML = `
                    <div class="flip-card">
                        <div class="flip-card-inner">
                            <div class="flip-card-front">
                                 <img class="h-full w-full object-cover" src="${data.profilePhotoUrl}" alt="Model ${data.fullName}" onerror="this.src='https://placehold.co/400x400/FBBF24/FFFFFF?text=Image'">
                                 <div class="absolute bottom-0 left-0 right-0 p-2 bg-black bg-opacity-50 text-white text-left">
                                    <h4 class="text-lg font-bold pointer-events-none">${data.fullName}</h4>
                                    <p class="text-sm pointer-events-none">${data.experience}</p>
                                </div>
                            </div>
                            <div class="flip-card-back">
                                <h4>${data.fullName}</h4>
                                <p><strong>Nationality:</strong> ${data.nationality || 'N/A'}</p>
                                <p><strong>Experience:</strong> ${data.experience || 'N/A'}</p>
                                <p><strong>Location:</strong> ${data.location || 'N/A'}</p>
                                <p><strong>Languages:</strong> ${data.languages || 'N/A'}</p>
                                <button class="view-details-btn mt-auto w-full bg-yellow-400 text-gray-800 font-semibold py-2 rounded-lg hover:bg-yellow-500">View Details</button>
                            </div>
                        </div>
                    </div>
                `;
                if(modelCardsContainer) modelCardsContainer.appendChild(cardWrapper);
            };

            if(modelCardsContainer) modelCardsContainer.addEventListener('click', (e) => {
                const card = e.target.closest('.model-card');
                if (!card) return;
                const modelData = JSON.parse(card.dataset.modelInfo);
                if (e.target.closest('.view-details-btn')) {
                    showModelDetailsModal(modelData);
                }
            });

            const showModelDetailsModal = (data) => {
                if(!modalContentBox || !modelDetailsModal) return;
                modalContentBox.innerHTML = `
                    <div class="flex justify-between items-start mb-4">
                        <h2 class="text-3xl font-bold">${data.fullName}</h2>
                        <button id="modal-close-btn" class="text-gray-500 hover:text-gray-800 text-4xl">&times;</button>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
                        <div class="md:col-span-1">
                            <img src="${data.profilePhotoUrl}" alt="${data.fullName}" class="rounded-lg shadow-lg w-full object-cover" onerror="this.src='https://placehold.co/400x400/FBBF24/FFFFFF?text=Image'">
                            <div class="flex justify-center space-x-4 mt-4">
                                <button class="modal-edit-btn action-btn bg-blue-500 hover:bg-blue-600" title="Edit Model" data-model-id="${data.id}">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-pencil pointer-events-none"><path d="M17 3a2.85 2.83 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5Z"/><path d="m15 5 4 4"/></svg>
                                </button>
                                <button class="modal-delete-btn action-btn bg-red-500 hover:bg-red-600" title="Delete Model" data-model-id="${data.id}">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-trash-2 pointer-events-none"><path d="M3 6h18"/><path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"/><path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"/><line x1="10" x2="10" y1="11" y2="17"/><line x1="14" x2="14" y1="11" y2="17"/></svg>
                                </button>
                            </div>
                        </div>
                        <div class="md:col-span-2 space-y-4">
                            <h3 class="text-xl font-semibold border-b pb-2">Details</h3>
                            <div class="grid grid-cols-2 gap-x-4 gap-y-2 text-sm">
                                <p><strong>Nationality:</strong> ${data.nationality || 'N/A'}</p>
                                <p><strong>Location:</strong> ${data.location || 'N/A'}</p>
                                <p><strong>Height:</strong> ${data.height ? data.height + ' cm' : 'N/A'}</p>
                                <p><strong>Experience:</strong> ${data.experience || 'N/A'}</p>
                                <p><strong>Languages:</strong> ${data.languages || 'N/A'}</p>
                                <p><strong>Phone:</strong> ${data.phoneNumber || 'N/A'}</p>
                                <p class="col-span-2"><strong>Email:</strong> ${data.email || 'N/A'}</p>
                                <p class="col-span-2"><strong>Portfolio:</strong> <a href="${data.portfolio}" target="_blank" class="text-blue-600 hover:underline">${data.portfolio || 'N/A'}</a></p>
                                <p class="col-span-2"><strong>Wears:</strong> <span class="font-normal">${(data.willingToWear || []).join(', ') || 'N/A'}</span></p>
                            </div>
                            <h3 class="text-xl font-semibold border-b pb-2 pt-4">Internal Info</h3>
                             <div class="grid grid-cols-2 gap-x-4 gap-y-2 text-sm">
                                <p><strong>Rate:</strong> ${data.rate ? '$' + data.rate + '/day' : 'N/A'}</p>
                                <p><strong>Commission:</strong> ${data.commission ? data.commission + '%' : 'N/A'}</p>
                                <p class="col-span-2"><strong>IBAN:</strong> ${data.iban || 'N/A'}</p>
                                <p class="col-span-2"><strong>Notes:</strong><br><span class="font-normal whitespace-pre-wrap">${data.notes || 'None'}</span></p>
                            </div>
                        </div>
                    </div>
                `;
                modelDetailsModal.classList.add('show');
            };

            if(modelDetailsModal) modelDetailsModal.addEventListener('click', (e) => {
                if (e.target === modelDetailsModal || e.target.closest('#modal-close-btn')) {
                    modelDetailsModal.classList.remove('show');
                }
            });

            if(modalContentBox) modalContentBox.addEventListener('click', async (e) => {
                const editBtn = e.target.closest('.modal-edit-btn');
                const deleteBtn = e.target.closest('.modal-delete-btn');

                if (editBtn) {
                    const modelId = editBtn.dataset.modelId;
                    const modelData = models.find(m => m.id === modelId);
                    if (modelData) {
                        populateFormForEdit(modelData);
                        modelDetailsModal.classList.remove('show');
                    }
                }

                if (deleteBtn) {
                    const modelId = deleteBtn.dataset.modelId;
                    const modelData = models.find(m => m.id === modelId);
                    if (modelData && confirm(`Are you sure you want to delete ${modelData.fullName}?`)) {
                        await deleteDoc(doc(db, 'models', modelId));
                        addLog(`Deleted model: ${modelData.fullName}`);
                        loadModelsFromFirestore();
                        modelDetailsModal.classList.remove('show');
                    }
                }
            });

            const populateFormForEdit = (data) => {
                document.getElementById('editModelId').value = data.id;
                document.getElementById('form-title').textContent = `Editing: ${data.fullName}`;
                document.getElementById('save-model-btn').textContent = 'Update Model';

                for (const key in data) {
                    const el = document.getElementById(key);
                    if (el) {
                        if (key === 'willingToWear') {
                            document.querySelectorAll('#willingToWearCheckboxes input').forEach(cb => {
                                cb.checked = (data.willingToWear || []).includes(cb.value);
                            });
                        } else {
                            el.value = data[key];
                        }
                    }
                }
                document.getElementById('profilePhoto').required = false;
                showForm(true);
                window.scrollTo(0, 0);
            };

            if(searchInput) searchInput.addEventListener('input', (e) => {
                const searchTerm = e.target.value.toLowerCase();
                document.querySelectorAll('.model-card').forEach(card => {
                    const modelData = JSON.parse(card.dataset.modelInfo);
                    const isVisible = modelData.fullName.toLowerCase().includes(searchTerm);
                    card.classList.toggle('hidden', !isVisible);
                });
            });

            // --- Date Range Selector Logic ---
            const dateRangeBtn = document.getElementById('date-range-btn');
            const dateRangeCard = document.getElementById('date-range-card');
            const dateRangeText = document.getElementById('date-range-text');
            const dateRangeOptions = document.querySelectorAll('.date-range-option');
            const fromDateInput = document.getElementById('from-date');
            const toDateInput = document.getElementById('to-date');
            const applyDateRangeBtn = document.getElementById('apply-date-range');

            const toggleDateRangeCard = (show) => {
                if(!dateRangeCard) return;
                if (show) {
                    dateRangeCard.classList.remove('hidden', 'opacity-0', 'scale-95');
                } else {
                    dateRangeCard.classList.add('opacity-0', 'scale-95');
                    setTimeout(() => {
                        dateRangeCard.classList.add('hidden');
                    }, 200); // Corresponds to transition duration
                }
            };

            const formatDate = (date) => {
                return date.toISOString().split('T')[0]; // YYYY-MM-DD format
            }

            const updateDateInputs = (days) => {
                const endDate = new Date();
                const startDate = new Date();
                if(days){
                    startDate.setDate(endDate.getDate() - days);
                    if(fromDateInput) fromDateInput.value = formatDate(startDate);
                    if(toDateInput) toDateInput.value = formatDate(endDate);
                } else { // All Time
                    if(fromDateInput) fromDateInput.value = '';
                    if(toDateInput) toDateInput.value = '';
                }
            }

            if (dateRangeBtn) {
                dateRangeBtn.addEventListener('click', (e) => {
                    e.stopPropagation();
                    if(dateRangeCard) {
                        const isHidden = dateRangeCard.classList.contains('hidden');
                        toggleDateRangeCard(isHidden);
                    }
                });
            }

            if (dateRangeOptions) {
                dateRangeOptions.forEach(option => {
                    option.addEventListener('click', () => {
                        const range = option.textContent;
                        if(dateRangeText) dateRangeText.textContent = range;

                        dateRangeOptions.forEach(opt => {
                            opt.classList.remove('bg-yellow-400', 'text-white');
                            opt.classList.add('bg-gray-100', 'text-gray-700');
                        });
                        option.classList.add('bg-yellow-400', 'text-white');
                        option.classList.remove('bg-gray-100', 'text-gray-700');

                        if (range === 'Last 7 Days') updateDateInputs(7);
                        else if (range === 'Last 30 Days') updateDateInputs(30);
                        else if (range === 'Last Year') updateDateInputs(365);
                        else if (range === 'All Time') updateDateInputs(null);

                        toggleDateRangeCard(false);
                        // Here you would typically trigger a data refresh function, e.g., loadDataForRange()
                    });
                });
            }

            if (applyDateRangeBtn) {
                applyDateRangeBtn.addEventListener('click', () => {
                    if (fromDateInput.value && toDateInput.value) {
                         if(dateRangeText) {
                            const from = new Date(fromDateInput.value).toLocaleDateString('en-US', { month: 'short', day: 'numeric' });
                            const to = new Date(toDateInput.value).toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' });
                            dateRangeText.textContent = `${from} - ${to}`;
                         }
                    } else {
                        if(dateRangeText) dateRangeText.textContent = 'Custom Range';
                    }
                    toggleDateRangeCard(false);
                    // Here you would typically trigger a data refresh function, e.g., loadDataForRange()
                });
            }

            document.addEventListener('click', (e) => {
                if (dateRangeCard && !dateRangeCard.classList.contains('hidden')) {
                    if (!dateRangeBtn.contains(e.target) && !dateRangeCard.contains(e.target)) {
                        toggleDateRangeCard(false);
                    }
                }
            });

            // --- Chart Logic ---
            function initializeChart() {
                const revenueChartCanvas = document.getElementById('revenueChart');
                if(revenueChartCanvas) {
                    const ctx = revenueChartCanvas.getContext('2d');
                    const chartTypeSelector = document.getElementById('chartTypeSelector');
                    const chartTitle = document.getElementById('chart-title');
                    let dataChart;

                    const labels = ['January', 'February', 'March', 'April', 'May', 'June', 'July'];

                    const revenueDataset = {
                        label: 'Revenue',
                        data: [65000, 59000, 80000, 81000, 56000, 55000, 40000],
                        borderColor: '#FBBF24',
                        backgroundColor: 'rgba(251, 191, 36, 0.2)',
                        tension: 0.4,
                        fill: true
                    };

                    const profitDataset = {
                        label: 'Profit',
                        data: [12500, 19000, 13000, 15000, 12000, 11000, 9000],
                        borderColor: '#3B82F6',
                        backgroundColor: 'rgba(59, 130, 246, 0.2)',
                        tension: 0.4,
                        fill: true
                    };

                    const chartConfig = {
                        type: 'line',
                        data: {
                            labels: labels,
                            datasets: [revenueDataset]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            scales: { y: { beginAtZero: true } },
                            plugins: { legend: { display: false } },
                            animation: {
                                duration: 800,
                                easing: 'easeInOutQuart'
                            }
                        }
                    };

                    dataChart = new Chart(ctx, chartConfig);

                    if(chartTypeSelector) {
                        chartTypeSelector.addEventListener('change', function(event) {
                            const selectedValue = event.target.value;

                            if (selectedValue === 'revenue') {
                                dataChart.data.datasets = [revenueDataset];
                                chartTitle.textContent = 'Revenue';
                            } else if (selectedValue === 'profit') {
                                dataChart.data.datasets = [profitDataset];
                                chartTitle.textContent = 'Profit';
                            }

                            dataChart.update();
                        });
                    }
                }
            }

            // --- Contract & E-Signature Logic ---
            const contractModal = document.getElementById('contract-modal');
            const createContractBtn = document.getElementById('create-contract-btn');
            const closeContractModalBtn = document.getElementById('contract-modal-close-btn');
            const cancelContractBtn = document.getElementById('cancel-contract-btn');
            const contractForm = document.getElementById('contract-form');
            const signatureModal = document.getElementById('signature-modal');
            const modelLinkModal = document.getElementById('model-link-modal');
            const contractHistoryContainer = document.getElementById('contract-history-container');

            const showContractModal = (show = true) => {
                if (!contractModal) return;
                contractModal.classList.toggle('show', show);
                if (!show) contractForm.reset();
            };

            const showSignatureModal = (show = true) => {
                if (!signatureModal) return;
                signatureModal.classList.toggle('show', show);
                if(show) {
                    resizeCanvas(document.getElementById('admin-signature-pad'), adminSignaturePad);
                } else {
                    adminSignaturePad.clear();
                }
            };

            const showModelLinkModal = (show = true, link = '') => {
                if (!modelLinkModal) return;
                modelLinkModal.classList.toggle('show', show);
                if(show) {
                    document.getElementById('model-link-input').value = link;
                }
            };

            if (createContractBtn) createContractBtn.addEventListener('click', () => showContractModal(true));
            if (closeContractModalBtn) closeContractModalBtn.addEventListener('click', () => showContractModal(false));
            if (cancelContractBtn) cancelContractBtn.addEventListener('click', () => showContractModal(false));
            if (contractModal) contractModal.addEventListener('click', (e) => {
                if (e.target === contractModal) showContractModal(false);
            });

            if (contractForm) {
                contractForm.addEventListener('submit', (e) => {
                    e.preventDefault();
                    currentContract = {
                        modelName: document.getElementById('modelName').value,
                        agencyRepresentative: document.getElementById('agencyRepresentative').value,
                        contractDate: document.getElementById('contractDate').value,
                        status: 'Awaiting Model Signature',
                        adminSignature: null,
                        modelSignature: null
                    };
                    showContractModal(false);
                    showSignatureModal(true);
                });
            }

            // Admin Signature Pad
            const adminSignatureCanvas = document.getElementById('admin-signature-pad');
            adminSignaturePad = new SignaturePad(adminSignatureCanvas);

            document.getElementById('clear-admin-signature').addEventListener('click', () => adminSignaturePad.clear());
            document.getElementById('upload-signature').addEventListener('change', (e) => {
                const file = e.target.files[0];
                if(file) {
                    toBase64(file).then(dataUrl => {
                        adminSignaturePad.fromDataURL(dataUrl, {width: adminSignatureCanvas.width, height: adminSignatureCanvas.height});
                    });
                }
            });

            document.getElementById('save-admin-signature').addEventListener('click', async () => {
                if (adminSignaturePad.isEmpty()) {
                    showNotification("Please provide a signature.", "error");
                    return;
                }
                currentContract.adminSignature = adminSignaturePad.toDataURL();

                const docRef = await addDoc(contractsCollectionRef(), currentContract);
                addLog(`Generated contract for ${currentContract.modelName}`);

                const link = `${window.location.origin}/contract.html?contractId=${docRef.id}`;
                showSignatureModal(false);
                showModelLinkModal(true, link);
            });

            document.getElementById('copy-link-btn').addEventListener('click', (e) => {
                const input = document.getElementById('model-link-input');
                input.select();
                document.execCommand('copy');
                e.target.textContent = 'Copied!';
                setTimeout(() => e.target.textContent = 'Copy', 2000);
            });
            document.getElementById('close-link-modal').addEventListener('click', () => showModelLinkModal(false));

            function renderContractHistory() {
                if (!contractHistoryContainer) return;
                if (contracts.length === 0) {
                    contractHistoryContainer.innerHTML = `<div class="text-center text-gray-500 py-12"><p>No contracts have been generated yet.</p></div>`;
                } else {
                    contractHistoryContainer.innerHTML = `
                        <div class="overflow-x-auto">
                            <table class="min-w-full bg-white">
                                <thead class="bg-gray-50">
                                    <tr>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Model Name</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Status</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Action</th>
                                    </tr>
                                </thead>
                                <tbody class="bg-white divide-y divide-gray-200">
                                    ${contracts.map(c => `
                                        <tr>
                                            <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">${c.modelName}</td>
                                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${c.status}</td>
                                            <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                                                ${c.status.startsWith('Signed') ? `<button data-contract-id="${c.id}" class="download-btn text-blue-600 hover:text-blue-900">Download</button>` : `<button data-contract-id="${c.id}" class="copy-link-btn-history text-blue-600 hover:text-blue-900">Copy Link</button>`}
                                            </td>
                                        </tr>
                                    `).join('')}
                                </tbody>
                            </table>
                        </div>
                    `;
                }
            }

            if(contractHistoryContainer) {
                contractHistoryContainer.addEventListener('click', async (e) => {
                    const contractId = e.target.dataset.contractId;
                    if(!contractId) return;

                    if(e.target.classList.contains('download-btn')) {
                        const docRef = doc(db, `contracts`, contractId);
                        const docSnap = await getDoc(docRef);
                        if(docSnap.exists()) generateFinalPdf({id: docSnap.id, ...docSnap.data()});
                    }
                    if(e.target.classList.contains('copy-link-btn-history')) {
                         const link = `${window.location.origin}/contract.html?contractId=${contractId}`;
                         showModelLinkModal(true, link);
                    }
                });
            }

            // --- Utility Functions ---
            const toBase64 = file => new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.readAsDataURL(file);
                reader.onload = () => resolve(reader.result);
                reader.onerror = error => reject(error);
            });

            function resizeCanvas(canvas, pad) {
                const ratio =  Math.max(window.devicePixelRatio || 1, 1);
                canvas.width = canvas.offsetWidth * ratio;
                canvas.height = canvas.offsetHeight * ratio;
                canvas.getContext("2d").scale(ratio, ratio);
                pad.clear(); // otherwise isEmpty() might return incorrect value
            }

            // --- Notification Logic ---
            const notificationContainer = document.getElementById('notification-container');
            const showNotification = (message, type = 'success') => {
                const notification = document.createElement('div');
                notification.className = `notification ${type}`;
                notification.textContent = message;
                notificationContainer.appendChild(notification);

                setTimeout(() => {
                    notification.classList.add('show');
                }, 10);

                setTimeout(() => {
                    notification.classList.remove('show');
                    notification.addEventListener('transitionend', () => notification.remove());
                }, 5000);
            };

            function generateFinalPdf(contract) {
                const doc = new jsPDF();
                const contractTerms = [
                    "1. Parties Involved: This Agreement is between VD Smedia, a marketing agency based in the UAE, and the individual model named below.",
                    "2. Scope of Work: The Model agrees to participate in photo and/or video shoots as arranged by VD Smedia for its clients' content marketing needs.",
                    "3. Usage Rights: The Model grants VD Smedia and its clients perpetual, worldwide, and unrestricted rights to use all produced content for any purpose, including commercial, advertising, editorial, and social media, without any time limit.",
                    "4. Compensation: The Model shall be compensated as agreed upon before each project. Payment details will be specified per project basis.",
                    "5. Work Schedule & Deliverables: The shoot schedule, location, and expectations will be communicated and agreed upon before each session.",
                    "6. Confidentiality Clause: The Model agrees to keep all information related to the shoot, client, project, or content strictly confidential. The Model shall not disclose or share any behind-the-scenes content or final deliverables on social media or elsewhere unless written permission is provided by VD Smedia.",
                    "7. Content Ownership: All content created during the shoot shall remain the sole property of VD Smedia and/or its clients. The Model waives any rights, claims, or approvals over the content.",
                    "8. Model Release: The Model grants full rights to be photographed and/or recorded and waives any right to inspect or approve the final content.",
                    "9. Code of Conduct: The Model agrees to behave professionally, arrive on time, and follow reasonable directions provided during the shoot.",
                    "10. Termination Clause: VD Smedia may terminate this agreement at any time if the Model breaches any of its terms, including failure to appear, unprofessional conduct, or violation of confidentiality.",
                    "11. Legal & Jurisdiction: This Agreement shall be governed by the laws of the United Arab Emirates. Any disputes shall be settled in a court of competent jurisdiction in the UAE.",
                    "12. Signatures: By signing below, both parties agree to the terms and conditions of this agreement."
                ];

                doc.setFontSize(18);
                doc.setFont('helvetica', 'bold');
                doc.text("Model Agreement - VD Smedia", 105, 20, { align: 'center' });

                doc.setFontSize(10);
                doc.setFont('helvetica', 'normal');
                doc.text(`This Model Agreement ("Agreement") is made between VD Smedia ("Agency") and the undersigned model ("Model") as of the date of signing.`, 20, 35, { maxWidth: 170 });

                doc.text(contractTerms.map(t => t).join('\n\n'), 20, 50, { maxWidth: 170 });

                let finalY = 230;

                doc.text("Model Name:", 20, finalY);
                doc.text(contract.modelName, 60, finalY);

                doc.text("Agency Representative (VD Smedia):", 20, finalY + 20);
                doc.text(contract.agencyRepresentative, 95, finalY + 20);

                doc.addImage(contract.modelSignature, 'PNG', 20, finalY + 5, 60, 15);
                doc.text("Model Signature:", 20, finalY + 25);

                doc.addImage(contract.adminSignature, 'PNG', 20, finalY + 25, 60, 15);
                doc.text("Agency Signature:", 20, finalY + 45);

                doc.text(`Date: ${contract.contractDate}`, 130, finalY);
                doc.text(`Date: ${contract.contractDate}`, 130, finalY + 20);

                doc.save(`Signed-Contract-${contract.modelName.replace(/\s/g, '_')}.pdf`);
            }

            function renderLogs(logs) {
                const logsContainer = document.getElementById('logs-container');
                if (!logsContainer) return;

                if (logs.length === 0) {
                    logsContainer.innerHTML = `<p class="text-gray-500 text-sm">No recent activity.</p>`;
                    return;
                }

                logsContainer.innerHTML = logs.slice(0, 5).map(log => {
                    const date = log.timestamp.toDate();
                    const timeAgo = formatTimeAgo(date);
                    const userDisplay = log.user ? `by ${log.user}` : '';
                    return `
                        <div class="flex items-start">
                            <span class="material-icons text-gray-400 mt-1 mr-3">history</span>
                            <div>
                                <p class="text-gray-800 font-medium">${log.message}</p>
                                <p class="text-gray-500 text-sm">${timeAgo} ${userDisplay}</p>
                            </div>
                        </div>
                    `;
                }).join('');
            }

            function formatTimeAgo(date) {
                const seconds = Math.floor((new Date() - date) / 1000);
                let interval = seconds / 31536000;
                if (interval > 1) return Math.floor(interval) + " years ago";
                interval = seconds / 2592000;
                if (interval > 1) return Math.floor(interval) + " months ago";
                interval = seconds / 86400;
                if (interval > 1) return Math.floor(interval) + " days ago";
                interval = seconds / 3600;
                if (interval > 1) return Math.floor(interval) + " hours ago";
                interval = seconds / 60;
                if (interval > 1) return Math.floor(interval) + " minutes ago";
                return Math.floor(seconds) + " seconds ago";
            }
        });
    </script>

</body>

</html>
